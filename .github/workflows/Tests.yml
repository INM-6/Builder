name: Tests
on: [push, pull_request]
jobs:
  BATS:
    strategy:
      fail-fast: false
      matrix:
        os: ["ubuntu-20.04"]
        envmodules: ["environment-modules", "lmod"]
    runs-on: ${{ matrix.os }}
    steps:
    - uses: actions/checkout@v2
    - name: Install ${{ matrix.envmodules }}
      run: sudo apt-get install ${{ matrix.envmodules }}
    - name: Install BATS
      run: |
        ./build.sh configure || true
        echo "y" | ./build.sh bats
    - name: Run BATS
      run: |
        source /etc/profile
        export MODULEPATH=$MODULEPATH:/home/runner/modules
        module avail
        module load bats
        bats tests/
